syntax = "proto3";

option java_multiple_files =  true;

package kademlia;

message PingRequest 
{
  bytes myNodeId = 1;
}

message PingResponse 
{
  bytes id = 1;
}

message Node
{
  bytes id = 1;
  string ip = 2;
  uint32 port = 3;
}

message StoreRequest
{
  bytes id = 1;
  bytes key = 2;
  string val = 3;
  string ip = 4;
  uint32 port = 5;
}

message StoreResponse
{
  bytes id = 1;
  bool stored = 2;
}

message FindNodeRequest
{
  bytes id = 1;
  string ip = 2;
  uint32 port = 3;
  bytes key = 4;
}

// Interativo ou recursivo
message FindNodeResponse
{
  bytes id = 1;
  repeated KademliaNode nodes = 2;
}

message FindValueRequest
{
  bytes id = 1;
  string ip = 2;
  uint32 port = 3;
  bytes key = 4;
}

message FindValueResponse
{
  bytes id = 1;
  //NÃ£o vai ser string provavelme3nte
  string val = 2;
  repeated Node nodes = 3;
}
service Kademlia
{
  // Unary
  rpc ping(PingRequest) returns (PingResponse);

  // store a [key, value] pair for later retrieval
  rpc store(StoreRequest) returns (StoreResponse);

  // 160-bit key as an argument, returns (IP address, UDP port, Node ID) for each k closest nodes to target id
  rpc findNode(FindNodeRequest) returns (FindNodeResponse);

  // similar to findNode + if RPC recipient received a STORE for the given key then it returns the stored value
  rpc findValue(FindValueRequest) returns (FindValueResponse);


}






